# 家庭智能记账

欢迎使用 **家庭智能记账**!这是一个基于大语言模型(LLM)驱动的智能记账系统。它不仅能通过文字、图片、语音快速记账,还能通过"对话"的方式修正账单,并提供强大的历史记录管理功能。

---

## 🚀 快速启动

### 1. 环境准备
确保您的机器已安装 Python 3.10+。

```bash
# 1. 复制项目到本地
cd 家庭记账

# 2. 创建并激活虚拟环境 (可选但推荐)
python3 -m venv venv
source venv/bin/activate

# 3. 安装依赖
pip install -r requirements.txt
```

### 2. 配置秘钥
在项目根目录创建 `.env` 文件（可参考 `.env.example`）：
```env
# 核心秘钥 (申请地址: openrouter.ai)
OPENROUTER_API_KEY=你的秘钥

# 数据库配置 (默认使用 SQLite)
DATABASE_URL=sqlite+aiosqlite:///./data/accounting.db
```

### 3. 启动服务
```bash
# 初始化数据库 (仅首次需运行)
python scripts/init_db.py

# 启动后端服务
uvicorn app.main:app --port 8000 --reload
```

### 4. 打开前端
您可以直接使用浏览器打开 `frontend/index.html`，或者访问：
[http://127.0.0.1:8000/frontend/index.html](http://127.0.0.1:8000/frontend/index.html)

---

## 💡 核心功能指南

### 1. 智能解析（多模式输入）
系统支持三种记账方式：

#### 📝 文字记账
在首页输入框中，您可以随意书写：
- **单笔记录**："刚才吃火锅花了120元"
- **多笔连记**："中午全家买菜55，打车15，给手机充话费100"
- **模糊记录**："昨天在物美买了点东西花了50"

#### 🎤 语音记账
- 切换到"语音"标签
- 点击麦克风按钮开始录音
- 系统自动转写并解析（开发中）

#### 📸 图片记账
- 切换到"图片"标签
- 支持三种上传方式：
  - **点击上传**：点击区域选择图片
  - **拖拽上传**：直接拖拽图片到上传区域
  - **粘贴上传**：复制图片后按 `Cmd+V` / `Ctrl+V` 粘贴
- AI 自动识别账单内容并解析

### 2. 对话式纠错（特色功能）
解析结果会显示在"暂存区"。您可以：
- **一键确认**：点击右上角的"全部确认"按钮
- **对话修改**：在输入框输入指令
  - "1金额改为80"
  - "2主分类改为交通"
  - "删除3"
- **批量操作**："1和2确认，3删掉"

### 3. 历史记录管理
强大的历史记录功能，支持：

#### 🔍 筛选功能
- **日期范围**：选择开始和结束日期
- **关键词搜索**：搜索备注、商户、消费人
- **一键重置**：清空所有筛选条件

#### 📱 加载更多
- 点击"加载更多"按钮查看更多记录
- 适合移动端操作，无需翻页

#### ✏️ 编辑记录
- 每条记录右侧有"编辑"按钮
- 弹窗式编辑对话框
- 可修改所有字段：日期、金额、分类、备注等

#### 🗑️ 删除记录
- 每条记录右侧有"删除"按钮
- 二次确认防止误删

### 4. 统计与导出
- **实时看板**：首页自动统计本月支出与本年支出
- **数据导出**：点击顶部"导出"按钮，一键下载 CSV 文件（兼容 Excel）

### 5. 分类管理
系统内置 **13 个标准一级分类**：
- 餐饮、交通、购物、居家、教育
- 医疗、人情、旅游、休闲娱乐、个人护理
- 通讯、运动、其他

**智能分类特性**：
- AI 自动匹配最合适的分类
- 支持自定义二级分类
- 系统会记录您的修正习惯，越用越准确

---

## 🛠 技术架构

| 层级 | 技术选型 | 说明 |
| :--- | :--- | :--- |
| **后端** | FastAPI (Python) | 异步高性能、内置 Swagger 文档 |
| **数据库** | SQLite / SQLAlchemy | 轻量化、支持多租户隔离 |
| **AI 引擎** | OpenRouter (GPT-4o/Claude-3) | 强大的非结构化数据解析能力 |
| **前端** | Vanilla JS + CSS3 | 玻璃拟态设计、原生极速体验 |
| **自动化** | Background Tasks | 暂存区自动清理、审计日志记录 |

---

## 📂 项目结构

```
家庭记账/
├── app/                    # 后端应用
│   ├── routers/           # API 路由
│   │   ├── auth.py       # 认证接口
│   │   ├── record.py     # 记账接口
│   │   ├── expenses.py   # 账单查询/管理
│   │   ├── export.py     # 数据导出
│   │   └── config.py     # 配置管理
│   ├── services/         # 业务逻辑
│   │   ├── llm_parser.py # AI 解析服务
│   │   └── instruction_parser.py # 指令解析
│   ├── models/           # 数据模型
│   └── utils/            # 工具函数
├── frontend/             # 前端应用
│   ├── index.html       # 主页面
│   ├── css/             # 样式文件
│   └── js/              # JavaScript 逻辑
├── prompts/             # AI 提示词
└── data/                # 数据库文件

```

---

## 🎯 最新更新

### v1.2.0 (2025-12-26)
- ✅ **分类体系统一**：精简为 13 个标准一级分类，消除重复
- ✅ **图片上传增强**：支持点击、拖拽、粘贴三种上传方式
- ✅ **全部确认按钮**：一键确认所有待确认记录
- ✅ **历史记录管理**：
  - 筛选功能（日期范围、关键词搜索）
  - 加载更多（适合移动端）
  - 编辑功能（弹窗式编辑对话框）
  - 删除功能（带二次确认）
- ✅ **统计优化**：改为按交易日期统计本月/本年支出

### v1.1.0
- ✅ 对话式纠错功能
- ✅ 多模式输入（文字、语音、图片）
- ✅ CSV 导出功能
- ✅ 审计日志系统

---

## 📅 常见问题 (FAQ)

**Q: 为什么识别不准？**
- A: 系统具备自学习能力，您通过对话修正过分类后，系统会记录该关键词，下次将更加准确。

**Q: 我的数据安全吗？**
- A: 系统采用多租户隔离设计，每个用户的数据通过唯一的 API Key 访问，账单哈希确保库内无重复。

**Q: 如何修改已有记录？**
- A: 在历史记录中，每条记录右侧有"编辑"按钮，点击即可修改所有字段。

**Q: 支持哪些图片格式？**
- A: 支持所有常见图片格式（JPG、PNG、WebP 等），可通过点击、拖拽或粘贴上传。

**Q: 如何筛选特定时间段的记录？**
- A: 在历史记录区域，使用日期范围选择器选择开始和结束日期，然后点击"筛选"按钮。

---

## 🔮 路线图

- [ ] 语音识别功能完善
- [ ] 移动端 APP（React Native）
- [ ] 预算管理功能
- [ ] 多人协作记账
- [ ] 数据可视化报表
- [ ] 自动分类规则学习

---

> [!TIP]
> **家庭智能记账** 仍在进化中。如果您有任何建议或发现问题，欢迎反馈！

---

## 📄 许可证

MIT License
```
